(function(e,o){e.fn.extend({modal:function(g){var h=e(document),l=e(o),m=e("body"),k="ontouchstart"in document.documentElement,a,b=!0,c=function(a){var c=a.scrollHeight===a.scrollTop+a.clientHeight;1>a.scrollTop&&(a.scrollTop=1,b=!1);c&&(a.scrollTop-=1,b=!1)},d=!1,i=function(a){var b=e("#lens-modal-backdrop"+a.data("index")),c=e("#lens-modal-wrapper"+a.data("index"));a.filter(":hidden").length||(a.off("click.close.modal"),b.off("click.close.modal.backdrop"),h.off("keyup.close.modal"),h.off("focusin.aria.modal"),
k&&c.off("scroll.modal touchstart.modal touchend.modal touchcancel.modal"),c.hide(),a.hide().attr("aria-hidden",!0),a.trigger("hide"),d=!1,e(".lens-modal").filter(":visible").length||m.removeClass("prevent-scroll"))},j=function(a){var b=l.width()-a.offset().left-a.outerWidth()-80;0>b&&(b=0);a.find(".lens-modal-close").css("right",b)};return this.each(function(){var f=e(this);switch(g||"default"){case "hide":i(f);break;case "resize":f.css("width","auto");var p=Math.max(l.width()-f.outerWidth(),0)/
2;f.css({"margin-left":"auto",left:p+l.scrollLeft()});j(f);break;default:var p=e("#lens-modal-backdrop"+f.data("index")),n=e("#lens-modal-wrapper"+f.data("index"));f.filter(":visible").length||(m.addClass("prevent-scroll"),f.on("click.close.modal",".lens-modal-close",function(a){i(f);a.preventDefault()}),p.on("click.close.model.backdrop",function(){i(f)}),h.on("keyup.close.modal",function(a){27===a.which&&i(f)}),h.off("focusin.aria.modal"),h.on("focusin.aria.modal",function(a){var b=a.target||a.srcElement;
d&&(b!==f[0]&&!f.find(b).length)&&(a.stopPropagation(),f[0].focus())}),k&&(n.on("touchstart.modal",function(){c(n.get(0))}),n.on("touchend.modal touchcancel.modal",function(){b=!0}),n.on("scroll.modal",function(){b&&(clearTimeout(a),a=setTimeout(function(){c(n.get(0))},16.66))})),n.show(),f.show().attr("aria-hidden",!1),f[0].focus(),j(f),f.trigger("show"),d=!0)}})}})})(window.jQuery,window);
(function(e,o){var o=o||{},g=function(a){this.options=e.extend(!0,{},g.defaults,o,a);this.restBase=this.options.restBase[this.getEnv(location.hostname)];this.sid=this.options.sid||window.sid;this.$modal=this.createLensElements();this.mainTemplate=this.currentItemId=this.$container=this.$triggerElem=null;this.resourceLoaded=!1;this.inFlight=this.dataAttributes=this.actionHash=this.data=null;g.cache.settings(this.options.cache);this.listen();this.triggerAction()};g.prototype={listen:function(){var a=
this,b,c;a.options.delegator?(b=e(a.options.delegator),c=a.options.trigger):(b=e(a.options.trigger),c=null);b.on("click",c,function(b){if(b.metaKey)return!0;if(a.exec(e(b.currentTarget||b.srcElement)))b.stopPropagation(),b.preventDefault()})},getEnv:function(a){return/(\.|^)qa\.ebay/i.test(a)||/(\.|^)corp\.ebay/i.test(a)||/(\.|^)dev\.ebay/i.test(a)?"qa":/latest/i.test(a)?"preprod":"prod"},triggerAction:function(){var a=window.location.hash,b=this.options.actionVerifier;if(a&&(!b||b(this.getActionType(a))))if((b=
/#lensaction=([0-9]+-?[0-9]*)\|/i.exec(a))&&b[1])this.dataAttributes=this.getActionDataAttributes(b[1]),this.actionHash=a,this.activateLens(this.dataAttributes&&this.dataAttributes.id)},getActionDataAttributes:function(a){if(!a)return null;a=a.split("-");return{id:a[0],"var":a[1]}},authRedirect:function(a,b,c){if(a=this.getRedirectURL(a,b,c))window.location=a},getRedirectURL:function(a,b,c){if(!a)return null;var d=window.location,d=d.toString().replace(d.hash,""),i=this.dataAttributes&&this.dataAttributes["var"],
d=d+("#lensaction="+this.currentItemId+(i?"-"+i:"")+"|"+(b||"")+"|"+encodeURIComponent(c||""));return a+"&ru="+encodeURIComponent(d)},getActionType:function(a){if(!a)return null;var a=/#lensaction=[0-9]+-?[0-9]*\|([^\|]+)\|/i.exec(a),b=null;a&&(b=a[1]);return b},getActionData:function(a){if(!a)return null;var a=/#lensaction=[0-9]+-?[0-9]*\|[^\|]+\|(.+)/i.exec(a),b=null;a&&(b=a[1]);return b},updateDataAttributes:function(a){this.dataAttributes=e.extend(this.dataAttributes,a)},reset:function(){this.actionHash===
window.location.hash&&(this.actionHash=null);this.dataAttributes=this.currentItemId=null;this.inFlight&&this.inFlight.abort();this.fire("lensUnload")},exec:function(a){try{var b=this.extractItemId(a);if(!b)return 0;this.$triggerElem=a;this.dataAttributes=a.data();this.activateLens(b)}catch(c){return 0}return 1},activateLens:function(a){a&&(this.currentItemId=a,this.show(),this.load(a))},extractItemId:function(a){var b=a.data("id"),c;if(!b&&(c=a.attr("href")))a=/http:\/\/[^\/]+\.ebay\.[^\/]+\/ws\/eBayISAPI.dll\?ViewItem&item=(\d+)/,
/http:\/\/[^\/]+\.ebay\.[^\/]+\/(soc\/)?itm\//.test(c)?(c=c.split("/"),b=c[c.length-1].split("?")[0]):a.test(c)?(c=c.match(a),b=c[1]):(c=c.split("/"),b=c[c.length-1].split("?")[0]),b=parseInt(b,10),isNaN(b)&&(b=0);return b},fallback:function(){if(this.$triggerElem){var a=this.$triggerElem.attr("href");this.close();a&&(window.location=a)}else this.close()},getCacheKey:function(a){return!a?null:a+"-"+this.$modal.data("index")},buildAjaxUrl:function(a,b){var c=this.dataAttributes,d=this.options.url?
this.options.url(this.restBase,a,c):this.restBase,i=/\?/.test(d)?"&":"?",e=this.sid||"";c&&c.sid&&(e=c.sid);return d+i+"tablet="+(g.isTablet?1:0)+"&_trksid="+e+(b?"&resource=1":"")},isAjaxable:function(a){if(!a)return!1;(a=a.match(/\/\/([^\/]+)\//))&&(a=a[1]);return!a?!0:location.hostname===a},fetch:function(a,b,c){var d=this,a=d.buildAjaxUrl(a,c),c=d.isAjaxable(a)?"json":"jsonp";d.inFlight=e.ajax({timeout:1E4,dataType:c,xhrFields:{withCredentials:!0},url:a,success:function(a){b(a)},error:function(a,
b){"abort"!==b&&d.fallback()}})},createContainer:function(a){if(a){if(this.$container)return this.$container;a=e(a).appendTo(this.$modal);a.attr("role","document");this.attachContainerEvents(a);return this.$container=a}},reloadLens:function(a,b){this.reset();this.dataAttributes=b;this.activateLens(a)},detachContainerEvents:function(a){a.off("lensActivate");a.off("lensClose");a.off("lensAuthenticate");a.off("lensClearCache");a.off("lensResize");a.off("lensUpdateDataAttributes")},attachContainerEvents:function(a){var b=
this;a.on("lensActivate",function(a,d){b.reloadLens(d.id,d.dataAttributes)});a.on("lensClose",function(){b.close()});a.on("lensAuthenticate",function(a,d){b.authRedirect(d.signinURL,d.actionType,d.actionData)});a.on("lensClearCache",function(a,d){g.cache.clear(b.getCacheKey(d.id))});a.on("lensResize",function(){b.resize()});a.on("lensUpdateDataAttributes",function(a,d){b.updateDataAttributes(d)})},resize:function(){this.$modal&&this.$modal.modal("resize")},processResources:function(a){this.mainTemplate=
a.mainTemplate;this.checkContainer(a.containerMarkup)?(this.resourceLoaded=!0,this.paint()):(this.createContainer(a.containerMarkup),this.loadResources(a.jsURL,a.styleTemplates))},checkContainer:function(a){if(!a)return!1;var b=e(a),a="#"+b.attr("id"),b=(b=b.attr("class"))?"."+b.replace(/\s+/,"."):"";return(a=e(a)[0]||e(b)[0])?(this.$container=e(a),!0):!1},moveContainer:function(){e.contains(this.$modal[0],this.$container[0])||(this.$container=this.$container.appendTo(this.$modal),this.detachContainerEvents(this.$container),
this.attachContainerEvents(this.$container))},fetchResources:function(a){var b=this,c=b.options.resourceData;c?b.processResources(c):b.fetch(a,function(a){b.processResources(a)},!0)},loadScript:function(a,b){var a=Array.isArray&&Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)?a:[a],c=0,d,e=a.length,j,f=document.getElementsByTagName("script")[0],g,h=function(){++c===e&&b&&b()},k=function(){var a=this.readyState;if("loaded"===a||"complete"===a||"completed"===a)this.onreadystatechange=
null,h()};for(d=0;d<e;d++)g=a[d],j=document.createElement("script"),j.type="text/javascript",j.async=!0,j.readyState?j.onreadystatechange=k:j.onload=j.onerror=h,j.src=g.url||g,f.parentNode.insertBefore(j,f)},applyStyles:function(a){var b=/<style[^>]*>(.*?)<\/style>/gim,c,d,i=[],j=function(a){for(var c=b.exec(a);c;)c[1]&&i.push(c[1]),c=b.exec(a)};if(a&&a.length){i.push('<style type="text/css">');c=0;for(d=a.length;c<d;c++)this.render(a[c],{},j);i.join("</style>");e("body").append(i.join(""))}},render:function(a,
b,c){var d=this;try{window.dust.render(a,b,function(a,b){a?d.fallback():c(b)})}catch(e){d.fallback()}},handleResources:function(a){this.resourceLoaded||(this.resourceLoaded=!0,this.applyStyles(a),this.paint())},loadResources:function(a,b){var c=this;a?c.loadScript(a,function(){c.handleResources(b)}):c.handleResources(b)},paint:function(){var a=this,b=a.data;if(a.resourceLoaded&&a.data){a.data=null;a.moveContainer();if(a.options.directMarkup)a.$container.html(b.markup),a.fireLensLoad();else{b=a.processData(b);
if(!b){a.fallback();return}a.$container.data("id",b.itemId);a.render(a.mainTemplate,b,function(b){a.$container.html(e(b).html());a.fireLensLoad()})}a.transition(!1)}},load:function(a){this.resourceLoaded||this.fetchResources(a);this.fetchData(a)},fireLensLoad:function(){this.fire("lensLoad",{actionType:this.getActionType(this.actionHash),actionData:this.getActionData(this.actionHash)})},fire:function(a,b){this.$container&&this.$container.trigger(a,b)},transition:function(a){var b=this.$modal,c=this.$container,
d=a?"addClass":"removeClass";c&&c.css("visibility",a?"hidden":"visible");b[d]("lens-modal-throbber")},processData:function(a){var b=this.options.dataMassager,c=a;b&&(c=b(a));b=c.itemId;if(!b||b.toString()!==this.currentItemId.toString())return null;this.options.cache&&!c.doNotCache&&g.cache.set(this.getCacheKey(b),a);return c},handleData:function(a){this.data=a;this.paint()},fetchData:function(a){var b=this,c=b.options.dataHandler,d=g.cache.get(this.getCacheKey(a));d?b.handleData(d):(b.transition(!0),
c?b.handleData(c(a)):b.fetch(a,function(a){b.handleData(a)}))},extractWidth:function(a){if(!a)return a;var b=/([0-9]+)(\D*)/.exec(a),a=b&&parseInt(b[1],10),b=b&&(b[2]||"px"),c;a&&(c={value:a,unit:b});return c},createLensElements:function(){var a=this,b=e("div.lens-modal").length,c=10100030*(b+1),d=e('<div class="lens-modal-wrapper"></div>').attr("id","lens-modal-wrapper"+b).css("z-index",c),i=e('<div class="lens-modal-backdrop"></div>').attr("id","lens-modal-backdrop"+b).css("z-index",c+10),b=e('<div class="lens-modal" tabindex="-1" role="dialog"></div>').attr("id",
"lens-modal"+b).css("z-index",c+20).data("index",b),c=e('<button class="lens-modal-close">X</button>'),j=e("body"),f=a.extractWidth(a.options.width);f&&b.css({width:f.value+f.unit,"margin-left":-(f.value/2)+f.unit});d=d.appendTo(j);b=b.appendTo(d);c=c.appendTo(b);i=i.appendTo(d);b.on("hide",function(){a.reset();a.$triggerElem&&a.$triggerElem.focus()});c.on("click",function(){a.close()});return b},close:function(){this.$modal&&this.$modal.modal("hide")},show:function(){this.$modal.modal()}};var h=
{},l=0,m=null,k={limit:10,duration:18E5};g.cache={get:function(a){return(a=h["i"+a])&&!(!a?0:(new Date).getTime()-a.ts>k.duration)?a.data:null},set:function(a,b){var c="i"+a;h[c]||(h[c]={key:c,data:b,ts:(new Date).getTime()},l++);l>k.limit&&(m||(m=setTimeout(function(){clearTimeout(m);m=null;var a,b,c=[],e;for(a in h)b=h[a],(!b?0:(new Date).getTime()-b.ts>k.duration)?delete h[a]:c.push(b);a=c.length;if(!(a<=k.limit)){c.sort(function(a,b){return b.ts-a.ts});a=c.splice(k.limit,a);b=0;for(e=a.length;b<
e;b++)delete h[a[b].key]}l=c.length},1E3)))},clear:function(a){a?(a="i"+a,h[a]&&(delete h[a],l--)):(h={},l=0)},getSize:function(){return l},settings:function(a){if("object"!==typeof a)return k;e.extend(k,a);return k}};g.isTablet=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Kindle|Touch/i.test(navigator.userAgent)||"ontouchstart"in document.documentElement;g.style='<style type="text/css">body.prevent-scroll {overflow: hidden; margin-right: 15px;}.lens-zoom {cursor:-webkit-zoom-in;cursor:-moz-zoom-in;cursor:zoom-in;}.lens-modal {position:absolute;top:7%;left:50%;width:962px;margin-left:-481px;overflow:visible;outline:none;border-radius:3px;min-height:100px;display:none;}.lens-modal-wrapper {position:fixed;left:0;top:0;width:100%;height:100%;display:none;overflow: auto;-webkit-overflow-scrolling:touch;background-color: rgba(0, 0, 0, 0.7);filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="#AA000000", endColorstr="#AA000000");}.lens-modal-backdrop {position:absolute;left:0;top:0;right:0;bottom:0;}.lens-modal-close {position:fixed;z-index:1;height:48px;width:60px;background-color:#fff;right:20px;top:0;border:0;border-radius:0 0 3px 3px;font-size:20px;color:#AAA;cursor:pointer;font-weight:bold;-moz-box-shadow:1px 1px 10px #333;-webkit-box-shadow: 1px 1px 10px #333;box-shadow: 1px 1px 10px #333;-webkit-transform: translateZ(0);-moz-transform: translateZ(0);-ms-transform: translateZ(0);transform: translateZ(0);}.lens-modal-close:hover {color: #00509d;}.lens-modal-throbber {background: url("http://p.ebaystatic.com/aw/eBay3.0/lensing/throbber_45px.gif") 50% 50% #FFF no-repeat;}@media (max-width: 962px) {.lens-modal{width:100%;margin-left:-50%;top:0}}@media (max-height: 768px) {.lens-modal{top:1%;}}</style>';
e("body").append(g.style);g.isTablet&&!e('meta[name="viewport"]').length&&e("head").append('<meta name="viewport" content="width=device-width, initial-scale=1"/>');g.defaults={trigger:".lens-item",restBase:{qa:"http://www.qa.ebay.com/itm/layer",preprod:"http://www.latest.ebay.com/itm/layer",prod:"http://www.ebay.com/itm/layer"},delegator:null,url:function(a,b,c){var d=[],e="",g;if(c)for(g in c)"id"!==g&&d.push(g+"="+encodeURIComponent(c[g]));d.length&&(e="?"+d.join("&"));return a+"/"+b+e},actionVerifier:function(a){var b=
["vi-watch","vi-collect","vi-default"],c,d=b.length;for(c=0;c<d;c++)if(b[c]===a)return!0;return!1},dataMassager:function(a){var b=window.LensModule;return b&&b.translator&&b.translator.item?b.translator.item.translate(a):a},cache:!0,dataHandler:null,resourceData:null,directMarkup:!1,width:null};e('script[data-init="true"]').length&&new g;window.Lens=g})(window.jQuery,window.LensConfig);